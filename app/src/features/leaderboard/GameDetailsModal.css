.bp-game-details-overlay {
  position: fixed !important;
  top: 63px !important; /* Start below AppLayout header */
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  background: var(--overlay-modal);
  display: flex !important;
  align-items: flex-start !important; /* Align content to top */
  justify-content: center !important;
  z-index: 2000;
  padding: 1rem;
  padding-top: 0.5rem; /* Small gap below header */
  backdrop-filter: blur(8px);
}

.bp-game-details-content {
  background: var(--bg-modal);
  backdrop-filter: blur(10px);
  border: 1px solid var(--border-secondary);
  border-radius: 1.25rem;
  max-width: 720px;
  width: 90%;
  /* Increased height for larger screens: taller to prevent bottom row cutoff */
  /* Account for header (63px) and padding (0.5rem top + 1rem bottom = ~24px) */
  max-height: min(calc(97vh - 63px - 1.5rem), calc(1050px - 63px));
  /* Increased min-height: taller to accommodate full grid */
  min-height: 830px;
  display: flex;
  flex-direction: column;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
  /* Ensure stable frame size */
  overflow: hidden;
}

.bp-game-details-body {
  display: flex;
  flex-direction: column;
  gap: 0.5rem; /* Further reduced to give more space to content area */
  overflow: hidden;
}

.bp-game-details-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 0.75rem; /* Reduced gap */
  padding: 0.75rem; /* Reduced padding to give more space */
  background: var(--bg-panel);
  border-radius: 0.5rem;
}

.bp-game-details-stat {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.bp-game-details-stat-label {
  font-size: 0.85rem;
  color: var(--text-muted);
}

.bp-game-details-stat-value {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--text-secondary);
}

.bp-game-details-tabs {
  display: flex;
  gap: 0.5rem;
  border-bottom: 1px solid var(--border-primary);
  padding: 0 1rem;
}

.bp-game-details-tab {
  background: none;
  border: none;
  padding: 0.75rem 1rem;
  color: var(--text-muted);
  cursor: pointer;
  font-size: 0.9rem;
  font-weight: 700;
  border-bottom: 2px solid transparent;
  margin-bottom: -1px;
  transition: color 0.2s ease;
}

.bp-game-details-tab:hover {
  color: var(--text-secondary);
}

.bp-game-details-tab--active {
  color: var(--link-focus);
  border-bottom-color: var(--link-focus);
}

.bp-game-details-content-area {
  flex: 1;
  overflow: hidden; /* Keep hidden to maintain layout */
  padding: 0.75rem; /* Reduced padding to give more space to grid */
  min-height: 500px;
  /* Adjusted for new modal height: increased to prevent cutoff on larger screens */
  /* Account for header (63px) and modal internal elements (stats, tabs, etc. ~180px) */
  max-height: calc(95vh - 63px - 180px); /* Even more reduced subtraction to ensure bottom row is visible */
  display: flex;
  flex-direction: column;
  /* Stable container that doesn't change size when content switches */
  position: relative;
  /* Ensure Firefox can properly calculate dimensions */
  width: 100%;
  min-height: 0; /* Critical for Firefox flexbox */
}

.bp-game-details-board {
  display: flex;
  width: 100%;
  height: 100%;
  min-height: 0;
  max-height: 100%;
  align-items: center;
  justify-content: center;
  overflow: auto; /* Keep auto to allow scrolling if needed */
  /* Ensure board doesn't affect container size */
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  /* Ensure Firefox properly calculates dimensions */
  box-sizing: border-box;
}

.bp-game-details-board .bp-bingo-grid-container {
  width: 100%;
  height: 100%;
  max-width: 100% !important; /* Use full width to prevent cutoff */
  max-height: 100% !important; /* Use full height to prevent cutoff */
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0.5rem; /* Small padding to prevent edge cutoff */
  box-sizing: border-box;
  /* Ensure container can expand to fit grid */
  min-width: 0;
  min-height: 0;
}

.bp-game-details-board .bp-bingo-grid {
  /* Mobile size: ~26% increase from min(60px, 12vw, 12vh) to min(76px, 15.1vw, 15.1vh) - 10% smaller than previous */
  --cell-size: min(76px, 15.1vw, 15.1vh);
  grid-template-columns: repeat(5, var(--cell-size));
  gap: calc(var(--cell-size) * 0.1);
  width: fit-content;
  height: fit-content;
  /* Scale grid to fit container - use 100% of available space */
  max-width: 100%;
  max-height: 100%;
  /* Ensure grid doesn't overflow container */
  box-sizing: border-box;
  margin: 0 auto; /* Center the grid */
  /* Allow grid to scale down if needed */
  transform-origin: center;
}

/* Desktop: Larger size to prevent cutoff */
@media (min-width: 768px) {
  .bp-game-details-board .bp-bingo-grid {
    /* Size to fit container: 10% smaller to ensure full grid is visible */
    --cell-size: min(86px, 17.1vw, 17.1vh);
    grid-template-columns: repeat(5, var(--cell-size));
    gap: calc(var(--cell-size) * 0.1);
    /* Ensure grid fits within container */
    max-width: 100%;
    max-height: 100%;
    width: fit-content;
    height: fit-content;
  }
  
  /* Ensure container uses full available space on desktop */
  .bp-game-details-board .bp-bingo-grid-container {
    max-width: 100% !important;
    max-height: 100% !important;
    padding: 0.5rem; /* Consistent padding */
    overflow: auto; /* Allow scrolling if grid is too large */
  }
}

.bp-game-details-history {
  height: 100%;
  min-height: 0; /* Changed from 100% for Firefox compatibility */
  max-height: 100%;
  overflow: auto;
  display: flex;
  flex-direction: column;
  /* Ensure history doesn't affect container size */
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  /* Ensure Firefox properly calculates dimensions */
  box-sizing: border-box;
  width: 100%;
}

/* Tab visibility toggling - prevents layout shifts */
/* Ensure proper visibility toggling with sufficient specificity */
.bp-game-details-board.bp-game-details-tab-active,
.bp-game-details-history.bp-game-details-tab-active {
  display: flex !important;
  visibility: visible !important;
  opacity: 1;
  pointer-events: auto;
  /* Ensure Firefox properly renders absolutely positioned content */
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
}

.bp-game-details-board.bp-game-details-tab-hidden,
.bp-game-details-history.bp-game-details-tab-hidden {
  display: none !important;
  visibility: hidden !important;
  opacity: 0;
  pointer-events: none;
}

.bp-game-details-empty {
  text-align: center;
  color: var(--text-muted);
  padding: 2rem;
  font-style: italic;
}

.bp-game-details-actions {
  padding: 0 1rem 1rem;
  display: flex;
  justify-content: center;
}

.bp-replay-button {
  padding: 0.75rem 1.5rem;
  border-radius: 0.75rem;
  border: none;
  background: var(--button-blue-bg);
  color: var(--button-blue-text);
  font-weight: 600;
  font-size: 0.95rem;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 2px 8px rgba(167, 139, 250, 0.3);
  transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.1s ease;
  box-shadow: 0 4px 12px rgba(167, 139, 250, 0.4);
}

.bp-replay-button:hover:not(:disabled) {
  background: var(--button-blue-hover);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(167, 139, 250, 0.5);
}

.bp-replay-button:active:not(:disabled) {
  transform: translateY(0);
  box-shadow: 0 2px 8px rgba(167, 139, 250, 0.3);
}

.bp-replay-button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

@media (max-width: 768px) {
  .bp-game-details-overlay {
    top: 63px !important; /* Start below AppLayout header */
    padding: 0.5rem 0.125rem 0.125rem; /* Top padding to ensure close button is visible */
    align-items: flex-start !important; /* Align to top to prevent modal from going above viewport */
    overflow-y: auto; /* Allow scrolling if modal is taller than viewport */
  }
  
  .bp-game-details-content {
    max-height: calc(100vh - 63px - 1rem); /* Account for header (63px) and top padding, ensure it never exceeds viewport */
    margin: 0;
    margin-top: 0; /* Ensure no top margin pushes it above viewport */
    width: 100%; /* Use full width */
    max-width: 100vw; /* Use full viewport width */
    min-height: auto; /* Remove min-height constraint on mobile */
  }
  
  .bp-modal-header {
    padding: 0.5rem 0.75rem;
  }
  
  .bp-modal-title {
    font-size: 1rem;
    padding-right: 0.5rem;
  }
  
  .bp-modal-close {
    width: 1.75rem;
    height: 1.75rem;
    font-size: 1rem;
  }
  
  .bp-game-details-stats {
    grid-template-columns: repeat(2, 1fr);
    gap: 0.375rem;
    padding: 0.375rem;
  }
  
  .bp-game-details-stat {
    gap: 0.125rem;
  }
  
  .bp-game-details-stat-label {
    font-size: 0.8rem;
  }
  
  .bp-game-details-stat-value {
    font-size: 0.95rem;
  }
  
  .bp-game-details-tabs {
    padding: 0 0.25rem;
    gap: 0.25rem;
  }
  
  .bp-game-details-tab {
    padding: 0.375rem 0.5rem;
    font-size: 0.85rem;
  }
  
  .bp-game-details-body {
    gap: 0.5rem;
  }
  
  .bp-game-details-content-area {
    padding: 0;
    min-height: 0;
    display: flex;
    flex-direction: column;
    aspect-ratio: 1;
    overflow: hidden;
  }
  
  .bp-game-details-board {
    /* Match history panel sizing exactly */
    height: 100%;
    min-height: 0;
    max-height: 100%;
    overflow: auto;
    display: flex;
    align-items: center;
    justify-content: center;
    /* Match history panel positioning */
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    /* Remove any padding/margin that might constrain size */
    padding: 0;
    margin: 0;
  }
  
  /* Ensure board container fits within available space and centers properly */
  /* Use full width and height without padding for maximum size */
  .bp-game-details-board .bp-bingo-grid-container {
    max-width: 100% !important; /* Use full width */
    max-height: 100% !important; /* Use full height */
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    box-sizing: border-box;
  }
  
  /* Ensure grid fits within container */
  .bp-game-details-board .bp-bingo-grid {
    /* ~26% increase: from min(60px, 12vw, 12vh) to min(76px, 15.1vw, 15.1vh) */
    --cell-size: min(76px, 15.1vw, 15.1vh);
    grid-template-columns: repeat(5, var(--cell-size));
    gap: calc(var(--cell-size) * 0.1);
    width: fit-content;
    height: fit-content;
    /* Remove max-width/max-height constraints to allow grid to use full container */
    margin: 0 auto; /* Center the grid */
    box-sizing: border-box;
  }
  
  .bp-game-details-history {
    height: 100%;
    min-height: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  
  .bp-game-details-actions {
    padding: 0 0.25rem 0.375rem;
  }
  
  .bp-replay-button {
    padding: 0.625rem 1.25rem;
    font-size: 0.9rem;
  }
  
  .bp-history-panel {
    margin-top: 0;
    height: 100%;
  }
  
  .bp-history-list {
    padding: 0.25rem;
    height: 100%;
  }
  
  .bp-history-item {
    padding: 0.3rem 0.5rem;
    margin-bottom: 0.125rem;
  }
  
  .bp-history-item-number {
    font-size: 0.75rem;
    min-width: 1.25rem;
  }
  
  .bp-history-item-title {
    font-size: 0.8rem;
  }
}

